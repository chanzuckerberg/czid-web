#!/bin/bash

export REPO=chanzuckerberg/idseq-web

BRANCH="branch-$1"
COMMIT="sha-$2"
BUILD_NUMBER="build-$3"

echo $BRANCH
echo $COMMIT
echo $REPO
echo $TAG
echo '--'
docker login -u $DOCKER_USER -p $DOCKER_PASS
if [ ! $? -eq 0 ]; then
    exit
fi

status=1
count=1
# Retry up to 5 times total if failed Docker push
until [ ${status} -eq 0 ] || [ $count -gt 5 ]; do
    docker push $REPO
    status=$?
    count=$((count+1))
    sleep 15
done
