#!/bin/bash

set -e

BRANCH=$1
COMMIT=$2
BUILD_NUMBER=$3


export REPO=chanzuckerberg/idseq-web
export TAG=`if [ "$BRANCH" == "master" ]; then echo "latest"; else echo $BRANCH; fi`

echo $BRANCH
echo $COMMIT
echo $REPO
echo $TAG
echo '--'
docker build -t $REPO:$COMMIT .
docker login -u $DOCKER_USER -p $DOCKER_PASS
docker tag $REPO:$COMMIT $REPO:$TAG
docker tag $REPO:$COMMIT $REPO:$BUILD_NUMBER
docker push $REPO