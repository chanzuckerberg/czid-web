{
    "events": [
        {
            "timestamp": 1582150678.745,
            "type": "ExecutionStarted",
            "id": 1,
            "previousEventId": 0,
            "executionStartedEventDetails": {
                "input": "{\"Input\": {\"HostFilter\": \"{\\\"fastqs_0\\\": \\\"s3://dummy-s3-bucket/samples/123/12345/fastqs/RR004_water_2_S23C_R2_001.fastq\\\"}\"}, \"HOST_FILTER_WDL_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter.wdl\", \"HOST_FILTER_OUTPUT_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter/output.json\", \"NON_HOST_ALIGNMENT_WDL_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/non_host_alignment.wdl\", \"NON_HOST_ALIGNMENT_OUTPUT_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/non_host_alignment/output.json\", \"POSTPROCESS_WDL_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/postprocess.wdl\", \"POSTPROCESS_OUTPUT_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/postprocess/output.json\", \"EXPERIMENTAL_WDL_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/experimental.wdl\", \"EXPERIMENTAL_OUTPUT_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/experimental/output.json\"}",
                "roleArn": "arn:aws:iam::123456789012:role/idseq-dev-sfn-service"
            }
        },
        {
            "timestamp": 1582150678.763,
            "type": "TaskStateEntered",
            "id": 2,
            "previousEventId": 0,
            "stateEnteredEventDetails": {
                "name": "HostFilterSPOT",
                "input": "{\"Input\": {\"HostFilter\": \"{\\\"fastqs_0\\\": \\\"s3://dummy-s3-bucket/samples/123/12345/fastqs/RR004_water_2_S23C_R2_001.fastq\\\"}\"}, \"HOST_FILTER_WDL_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter.wdl\", \"HOST_FILTER_OUTPUT_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter/output.json\", \"NON_HOST_ALIGNMENT_WDL_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/non_host_alignment.wdl\", \"NON_HOST_ALIGNMENT_OUTPUT_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/non_host_alignment/output.json\", \"POSTPROCESS_WDL_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/postprocess.wdl\", \"POSTPROCESS_OUTPUT_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/postprocess/output.json\", \"EXPERIMENTAL_WDL_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/experimental.wdl\", \"EXPERIMENTAL_OUTPUT_URI\": \"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/experimental/output.json\"}"
            }
        },
        {
            "timestamp": 1582150678.763,
            "type": "TaskScheduled",
            "id": 3,
            "previousEventId": 2,
            "taskScheduledEventDetails": {
                "resourceType": "batch",
                "resource": "submitJob.sync",
                "region": "us-west-2",
                "parameters": "{\"JobQueue\":\"idseq-dev-main-SPOT-normal\",\"JobName\":\"idseq-dev-main-HostFilterSPOT\",\"JobDefinition\":\"idseq-dev-main\",\"ContainerOverrides\":{\"Vcpus\":16,\"Environment\":[{\"Name\":\"MANAGED_BY_AWS\",\"Value\":\"STARTED_BY_STEP_FUNCTIONS\"},{\"Name\":\"WDL_INPUT\",\"Value\":\"{\\\"fastqs_0\\\": \\\"s3://dummy-s3-bucket/samples/123/12345/fastqs/RR004_water_2_S23C_R2_001.fastq\\\"}\"},{\"Name\":\"WDL_WORKFLOW_URI\",\"Value\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter.wdl\"},{\"Name\":\"WDL_OUTPUT_URI\",\"Value\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter/output.json\"},{\"Name\":\"CURRENT_STATE\",\"Value\":\"HostFilterSPOT\"}]}}"
            }
        },
        {
            "timestamp": 1582150678.798,
            "type": "TaskStarted",
            "id": 4,
            "previousEventId": 3,
            "taskStartedEventDetails": {
                "resourceType": "batch",
                "resource": "submitJob.sync"
            }
        },
        {
            "timestamp": 1582150678.893,
            "type": "TaskSubmitted",
            "id": 5,
            "previousEventId": 4,
            "taskSubmittedEventDetails": {
                "resourceType": "batch",
                "resource": "submitJob.sync",
                "output": "{\"JobId\":\"886b0371-1234-5678-9abc-def012345678\",\"JobName\":\"idseq-dev-main-HostFilterSPOT\",\"SdkHttpMetadata\":{\"HttpHeaders\":{\"Connection\":\"keep-alive\",\"Content-Length\":\"90\",\"Content-Type\":\"application/json\",\"Date\":\"Wed, 19 Feb 2020 22:17:58 GMT\",\"x-amz-apigw-id\":\"IKkTlHADPHcFZew=\",\"x-amzn-RequestId\":\"01c1c53c-1234-5678-9abc-def012345678\",\"X-Amzn-Trace-Id\":\"Root=1-5e4db416-af6892ddf4a050af74da6ea9;Sampled=0\"},\"HttpStatusCode\":200},\"SdkResponseMetadata\":{\"RequestId\":\"01c1c53c-1234-5678-9abc-def012345678\"}}"
            }
        },
        {
            "timestamp": 1582150955.787,
            "type": "TaskSucceeded",
            "id": 6,
            "previousEventId": 5,
            "taskSucceededEventDetails": {
                "resourceType": "batch",
                "resource": "submitJob.sync",
                "output": "{\"Attempts\":[{\"Container\":{\"ContainerInstanceArn\":\"arn:aws:ecs:us-west-2:123456789012:container-instance/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/4213762631364a818592795ac6becc76\",\"ExitCode\":0,\"LogStreamName\":\"idseq-dev-main/default/43756258c9a14677b7c4fde0af574bf5\",\"NetworkInterfaces\":[],\"TaskArn\":\"arn:aws:ecs:us-west-2:123456789012:task/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/43756258c9a14677b7c4fde0af574bf5\"},\"StartedAt\":1582150715389,\"StatusReason\":\"Essential container in task exited\",\"StoppedAt\":1582150953334}],\"Container\":{\"Command\":[\"/bin/bash\",\"-c\",\"for i in \\\"$@\\\"; do eval \\\"$i\\\"; done; cd /\",\"idseq\",\"set -a\",\"if [ -f /etc/environment ]; then source /etc/environment; fi\",\"if [ -f /etc/default/locale ]; then source /etc/default/locale; else export LC_ALL=C.UTF-8 LANG=C.UTF-8; fi\",\"set +a\",\"set -x\",\"rm -rf /mnt/20*\",\"df -h\",\"export AWS_DEFAULT_REGION=us-west-2 S3PARCP_DOCKER_IMAGE=123456789012.dkr.ecr.us-west-2.amazonaws.com/idseq-workflows\",\"if [ -f /etc/profile ]; then source /etc/profile; fi\",\"miniwdl --version\",\"set -euo pipefail\",\"export CURRENT_STATE=$(echo \\\"$CURRENT_STATE\\\" | sed -e s/SPOT// -e s/EC2//)\",\"aws s3 cp \\\"$WDL_WORKFLOW_URI\\\" .\",\"echo \\\"$WDL_INPUT\\\" > wdl_input.json\",\"miniwdl run --dir /mnt $(basename \\\"$WDL_WORKFLOW_URI\\\") --input wdl_input.json --verbose > wdl_output.json\",\"export WDL_OUTPUT_PREFIX=$(dirname \\\"$WDL_OUTPUT_URI\\\")\",\"jq .outputs wdl_output.json > wdl_out_s3.json\",\"for k in $(jq -r keys[] wdl_out_s3.json); do export k; local_path=$(jq -r '.[env.k]' wdl_out_s3.json); filename=$(basename \\\"$local_path\\\"); export dest=\\\"$WDL_OUTPUT_PREFIX/$filename\\\"; s3parcp \\\"$local_path\\\" \\\"$dest\\\"; jq '.[env.k]=env.dest' wdl_out_s3.json | sponge wdl_out_s3.json; done\",\"aws s3 cp wdl_out_s3.json \\\"$WDL_OUTPUT_URI\\\"\"],\"ContainerInstanceArn\":\"arn:aws:ecs:us-west-2:123456789012:container-instance/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/4213762631364a818592795ac6becc76\",\"Environment\":[{\"Name\":\"WDL_WORKFLOW_URI\",\"Value\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter.wdl\"},{\"Name\":\"WDL_OUTPUT_URI\",\"Value\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter/output.json\"},{\"Name\":\"CURRENT_STATE\",\"Value\":\"HostFilterSPOT\"},{\"Name\":\"WDL_INPUT\",\"Value\":\"{\\\"fastqs_0\\\": \\\"s3://dummy-s3-bucket/samples/123/12345/fastqs/RR004_water_2_S23C_R2_001.fastq\\\"}\"},{\"Name\":\"MANAGED_BY_AWS\",\"Value\":\"STARTED_BY_STEP_FUNCTIONS\"}],\"ExitCode\":0,\"Image\":\"123456789012.dkr.ecr.us-west-2.amazonaws.com/idseq-workflows\",\"JobRoleArn\":\"arn:aws:iam::123456789012:role/idseq-dev-batch-job\",\"LogStreamName\":\"idseq-dev-main/default/43756258c9a14677b7c4fde0af574bf5\",\"Memory\":1024,\"MountPoints\":[{\"ContainerPath\":\"/mnt\",\"ReadOnly\":false,\"SourceVolume\":\"scratch\"},{\"ContainerPath\":\"/var/run/docker.sock\",\"ReadOnly\":false,\"SourceVolume\":\"docker_sock\"}],\"NetworkInterfaces\":[],\"Privileged\":false,\"ReadonlyRootFilesystem\":false,\"ResourceRequirements\":[],\"TaskArn\":\"arn:aws:ecs:us-west-2:123456789012:task/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/43756258c9a14677b7c4fde0af574bf5\",\"Ulimits\":[{\"HardLimit\":100000,\"Name\":\"nofile\",\"SoftLimit\":100000}],\"Vcpus\":16,\"Volumes\":[{\"Host\":{\"SourcePath\":\"/mnt\"},\"Name\":\"scratch\"},{\"Host\":{\"SourcePath\":\"/var/run/docker.sock\"},\"Name\":\"docker_sock\"}]},\"CreatedAt\":1582150678868,\"DependsOn\":[],\"JobDefinition\":\"arn:aws:batch:us-west-2:123456789012:job-definition/idseq-dev-main:28\",\"JobId\":\"886b0371-1234-5678-9abc-def012345678\",\"JobName\":\"idseq-dev-main-HostFilterSPOT\",\"JobQueue\":\"arn:aws:batch:us-west-2:123456789012:job-queue/idseq-dev-main-SPOT-normal\",\"Parameters\":{},\"RetryStrategy\":{\"Attempts\":1},\"StartedAt\":1582150715389,\"Status\":\"SUCCEEDED\",\"StatusReason\":\"Essential container in task exited\",\"StoppedAt\":1582150953334,\"Timeout\":{\"AttemptDurationSeconds\":86400}}"
            }
        },
        {
            "timestamp": 1582150955.787,
            "type": "TaskStateExited",
            "id": 7,
            "previousEventId": 6,
            "stateExitedEventDetails": {
                "name": "HostFilterSPOT",
                "output": "{\"Input\":{\"HostFilter\":\"{\\\"fastqs_0\\\": \\\"s3://dummy-s3-bucket/samples/123/12345/fastqs/RR004_water_2_S23C_R2_001.fastq\\\"}\"},\"HOST_FILTER_WDL_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter.wdl\",\"HOST_FILTER_OUTPUT_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter/output.json\",\"NON_HOST_ALIGNMENT_WDL_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/non_host_alignment.wdl\",\"NON_HOST_ALIGNMENT_OUTPUT_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/non_host_alignment/output.json\",\"POSTPROCESS_WDL_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/postprocess.wdl\",\"POSTPROCESS_OUTPUT_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/postprocess/output.json\",\"EXPERIMENTAL_WDL_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/experimental.wdl\",\"EXPERIMENTAL_OUTPUT_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/experimental/output.json\",\"BatchJobDetails\":{\"HostFilter\":{\"Attempts\":[{\"Container\":{\"ContainerInstanceArn\":\"arn:aws:ecs:us-west-2:123456789012:container-instance/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/4213762631364a818592795ac6becc76\",\"ExitCode\":0,\"LogStreamName\":\"idseq-dev-main/default/43756258c9a14677b7c4fde0af574bf5\",\"NetworkInterfaces\":[],\"TaskArn\":\"arn:aws:ecs:us-west-2:123456789012:task/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/43756258c9a14677b7c4fde0af574bf5\"},\"StartedAt\":1582150715389,\"StatusReason\":\"Essential container in task exited\",\"StoppedAt\":1582150953334}],\"Container\":{\"Command\":[\"/bin/bash\",\"-c\",\"for i in \\\"$@\\\"; do eval \\\"$i\\\"; done; cd /\",\"idseq\",\"set -a\",\"if [ -f /etc/environment ]; then source /etc/environment; fi\",\"if [ -f /etc/default/locale ]; then source /etc/default/locale; else export LC_ALL=C.UTF-8 LANG=C.UTF-8; fi\",\"set +a\",\"set -x\",\"rm -rf /mnt/20*\",\"df -h\",\"export AWS_DEFAULT_REGION=us-west-2 S3PARCP_DOCKER_IMAGE=123456789012.dkr.ecr.us-west-2.amazonaws.com/idseq-workflows\",\"if [ -f /etc/profile ]; then source /etc/profile; fi\",\"miniwdl --version\",\"set -euo pipefail\",\"export CURRENT_STATE=$(echo \\\"$CURRENT_STATE\\\" | sed -e s/SPOT// -e s/EC2//)\",\"aws s3 cp \\\"$WDL_WORKFLOW_URI\\\" .\",\"echo \\\"$WDL_INPUT\\\" > wdl_input.json\",\"miniwdl run --dir /mnt $(basename \\\"$WDL_WORKFLOW_URI\\\") --input wdl_input.json --verbose > wdl_output.json\",\"export WDL_OUTPUT_PREFIX=$(dirname \\\"$WDL_OUTPUT_URI\\\")\",\"jq .outputs wdl_output.json > wdl_out_s3.json\",\"for k in $(jq -r keys[] wdl_out_s3.json); do export k; local_path=$(jq -r '.[env.k]' wdl_out_s3.json); filename=$(basename \\\"$local_path\\\"); export dest=\\\"$WDL_OUTPUT_PREFIX/$filename\\\"; s3parcp \\\"$local_path\\\" \\\"$dest\\\"; jq '.[env.k]=env.dest' wdl_out_s3.json | sponge wdl_out_s3.json; done\",\"aws s3 cp wdl_out_s3.json \\\"$WDL_OUTPUT_URI\\\"\"],\"ContainerInstanceArn\":\"arn:aws:ecs:us-west-2:123456789012:container-instance/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/4213762631364a818592795ac6becc76\",\"Environment\":[{\"Name\":\"WDL_WORKFLOW_URI\",\"Value\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter.wdl\"},{\"Name\":\"WDL_OUTPUT_URI\",\"Value\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter/output.json\"},{\"Name\":\"CURRENT_STATE\",\"Value\":\"HostFilterSPOT\"},{\"Name\":\"WDL_INPUT\",\"Value\":\"{\\\"fastqs_0\\\": \\\"s3://dummy-s3-bucket/samples/123/12345/fastqs/RR004_water_2_S23C_R2_001.fastq\\\"}\"},{\"Name\":\"MANAGED_BY_AWS\",\"Value\":\"STARTED_BY_STEP_FUNCTIONS\"}],\"ExitCode\":0,\"Image\":\"123456789012.dkr.ecr.us-west-2.amazonaws.com/idseq-workflows\",\"JobRoleArn\":\"arn:aws:iam::123456789012:role/idseq-dev-batch-job\",\"LogStreamName\":\"idseq-dev-main/default/43756258c9a14677b7c4fde0af574bf5\",\"Memory\":1024,\"MountPoints\":[{\"ContainerPath\":\"/mnt\",\"ReadOnly\":false,\"SourceVolume\":\"scratch\"},{\"ContainerPath\":\"/var/run/docker.sock\",\"ReadOnly\":false,\"SourceVolume\":\"docker_sock\"}],\"NetworkInterfaces\":[],\"Privileged\":false,\"ReadonlyRootFilesystem\":false,\"ResourceRequirements\":[],\"TaskArn\":\"arn:aws:ecs:us-west-2:123456789012:task/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/43756258c9a14677b7c4fde0af574bf5\",\"Ulimits\":[{\"HardLimit\":100000,\"Name\":\"nofile\",\"SoftLimit\":100000}],\"Vcpus\":16,\"Volumes\":[{\"Host\":{\"SourcePath\":\"/mnt\"},\"Name\":\"scratch\"},{\"Host\":{\"SourcePath\":\"/var/run/docker.sock\"},\"Name\":\"docker_sock\"}]},\"CreatedAt\":1582150678868,\"DependsOn\":[],\"JobDefinition\":\"arn:aws:batch:us-west-2:123456789012:job-definition/idseq-dev-main:28\",\"JobId\":\"886b0371-1234-5678-9abc-def012345678\",\"JobName\":\"idseq-dev-main-HostFilterSPOT\",\"JobQueue\":\"arn:aws:batch:us-west-2:123456789012:job-queue/idseq-dev-main-SPOT-normal\",\"Parameters\":{},\"RetryStrategy\":{\"Attempts\":1},\"StartedAt\":1582150715389,\"Status\":\"SUCCEEDED\",\"StatusReason\":\"Essential container in task exited\",\"StoppedAt\":1582150953334,\"Timeout\":{\"AttemptDurationSeconds\":86400}}}}"
            }
        },
        {
            "timestamp": 1582150955.794,
            "type": "TaskStateEntered",
            "id": 8,
            "previousEventId": 7,
            "stateEnteredEventDetails": {
                "name": "HostFilterReadOutput",
                "input": "{\"Input\":{\"HostFilter\":\"{\\\"fastqs_0\\\": \\\"s3://dummy-s3-bucket/samples/123/12345/fastqs/RR004_water_2_S23C_R2_001.fastq\\\"}\"},\"HOST_FILTER_WDL_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter.wdl\",\"HOST_FILTER_OUTPUT_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter/output.json\",\"NON_HOST_ALIGNMENT_WDL_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/non_host_alignment.wdl\",\"NON_HOST_ALIGNMENT_OUTPUT_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/non_host_alignment/output.json\",\"POSTPROCESS_WDL_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/postprocess.wdl\",\"POSTPROCESS_OUTPUT_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/postprocess/output.json\",\"EXPERIMENTAL_WDL_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/experimental.wdl\",\"EXPERIMENTAL_OUTPUT_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/experimental/output.json\",\"BatchJobDetails\":{\"HostFilter\":{\"Attempts\":[{\"Container\":{\"ContainerInstanceArn\":\"arn:aws:ecs:us-west-2:123456789012:container-instance/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/4213762631364a818592795ac6becc76\",\"ExitCode\":0,\"LogStreamName\":\"idseq-dev-main/default/43756258c9a14677b7c4fde0af574bf5\",\"NetworkInterfaces\":[],\"TaskArn\":\"arn:aws:ecs:us-west-2:123456789012:task/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/43756258c9a14677b7c4fde0af574bf5\"},\"StartedAt\":1582150715389,\"StatusReason\":\"Essential container in task exited\",\"StoppedAt\":1582150953334}],\"Container\":{\"Command\":[\"/bin/bash\",\"-c\",\"for i in \\\"$@\\\"; do eval \\\"$i\\\"; done; cd /\",\"idseq\",\"set -a\",\"if [ -f /etc/environment ]; then source /etc/environment; fi\",\"if [ -f /etc/default/locale ]; then source /etc/default/locale; else export LC_ALL=C.UTF-8 LANG=C.UTF-8; fi\",\"set +a\",\"set -x\",\"rm -rf /mnt/20*\",\"df -h\",\"export AWS_DEFAULT_REGION=us-west-2 S3PARCP_DOCKER_IMAGE=123456789012.dkr.ecr.us-west-2.amazonaws.com/idseq-workflows\",\"if [ -f /etc/profile ]; then source /etc/profile; fi\",\"miniwdl --version\",\"set -euo pipefail\",\"export CURRENT_STATE=$(echo \\\"$CURRENT_STATE\\\" | sed -e s/SPOT// -e s/EC2//)\",\"aws s3 cp \\\"$WDL_WORKFLOW_URI\\\" .\",\"echo \\\"$WDL_INPUT\\\" > wdl_input.json\",\"miniwdl run --dir /mnt $(basename \\\"$WDL_WORKFLOW_URI\\\") --input wdl_input.json --verbose > wdl_output.json\",\"export WDL_OUTPUT_PREFIX=$(dirname \\\"$WDL_OUTPUT_URI\\\")\",\"jq .outputs wdl_output.json > wdl_out_s3.json\",\"for k in $(jq -r keys[] wdl_out_s3.json); do export k; local_path=$(jq -r '.[env.k]' wdl_out_s3.json); filename=$(basename \\\"$local_path\\\"); export dest=\\\"$WDL_OUTPUT_PREFIX/$filename\\\"; s3parcp \\\"$local_path\\\" \\\"$dest\\\"; jq '.[env.k]=env.dest' wdl_out_s3.json | sponge wdl_out_s3.json; done\",\"aws s3 cp wdl_out_s3.json \\\"$WDL_OUTPUT_URI\\\"\"],\"ContainerInstanceArn\":\"arn:aws:ecs:us-west-2:123456789012:container-instance/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/4213762631364a818592795ac6becc76\",\"Environment\":[{\"Name\":\"WDL_WORKFLOW_URI\",\"Value\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter.wdl\"},{\"Name\":\"WDL_OUTPUT_URI\",\"Value\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter/output.json\"},{\"Name\":\"CURRENT_STATE\",\"Value\":\"HostFilterSPOT\"},{\"Name\":\"WDL_INPUT\",\"Value\":\"{\\\"fastqs_0\\\": \\\"s3://dummy-s3-bucket/samples/123/12345/fastqs/RR004_water_2_S23C_R2_001.fastq\\\"}\"},{\"Name\":\"MANAGED_BY_AWS\",\"Value\":\"STARTED_BY_STEP_FUNCTIONS\"}],\"ExitCode\":0,\"Image\":\"123456789012.dkr.ecr.us-west-2.amazonaws.com/idseq-workflows\",\"JobRoleArn\":\"arn:aws:iam::123456789012:role/idseq-dev-batch-job\",\"LogStreamName\":\"idseq-dev-main/default/43756258c9a14677b7c4fde0af574bf5\",\"Memory\":1024,\"MountPoints\":[{\"ContainerPath\":\"/mnt\",\"ReadOnly\":false,\"SourceVolume\":\"scratch\"},{\"ContainerPath\":\"/var/run/docker.sock\",\"ReadOnly\":false,\"SourceVolume\":\"docker_sock\"}],\"NetworkInterfaces\":[],\"Privileged\":false,\"ReadonlyRootFilesystem\":false,\"ResourceRequirements\":[],\"TaskArn\":\"arn:aws:ecs:us-west-2:123456789012:task/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/43756258c9a14677b7c4fde0af574bf5\",\"Ulimits\":[{\"HardLimit\":100000,\"Name\":\"nofile\",\"SoftLimit\":100000}],\"Vcpus\":16,\"Volumes\":[{\"Host\":{\"SourcePath\":\"/mnt\"},\"Name\":\"scratch\"},{\"Host\":{\"SourcePath\":\"/var/run/docker.sock\"},\"Name\":\"docker_sock\"}]},\"CreatedAt\":1582150678868,\"DependsOn\":[],\"JobDefinition\":\"arn:aws:batch:us-west-2:123456789012:job-definition/idseq-dev-main:28\",\"JobId\":\"886b0371-1234-5678-9abc-def012345678\",\"JobName\":\"idseq-dev-main-HostFilterSPOT\",\"JobQueue\":\"arn:aws:batch:us-west-2:123456789012:job-queue/idseq-dev-main-SPOT-normal\",\"Parameters\":{},\"RetryStrategy\":{\"Attempts\":1},\"StartedAt\":1582150715389,\"Status\":\"SUCCEEDED\",\"StatusReason\":\"Essential container in task exited\",\"StoppedAt\":1582150953334,\"Timeout\":{\"AttemptDurationSeconds\":86400}}}}"
            }
        },
        {
            "timestamp": 1582150955.794,
            "type": "TaskScheduled",
            "id": 9,
            "previousEventId": 8,
            "taskScheduledEventDetails": {
                "resourceType": "lambda",
                "resource": "invoke",
                "region": "us-west-2",
                "parameters": "{\"FunctionName\":\"idseq-dev-read-state-from-s3\",\"Payload\":{\"Input\":{\"Input\":{\"HostFilter\":\"{\\\"fastqs_0\\\": \\\"s3://dummy-s3-bucket/samples/123/12345/fastqs/RR004_water_2_S23C_R2_001.fastq\\\"}\"},\"HOST_FILTER_WDL_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter.wdl\",\"HOST_FILTER_OUTPUT_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter/output.json\",\"NON_HOST_ALIGNMENT_WDL_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/non_host_alignment.wdl\",\"NON_HOST_ALIGNMENT_OUTPUT_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/non_host_alignment/output.json\",\"POSTPROCESS_WDL_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/postprocess.wdl\",\"POSTPROCESS_OUTPUT_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/postprocess/output.json\",\"EXPERIMENTAL_WDL_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/experimental.wdl\",\"EXPERIMENTAL_OUTPUT_URI\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/experimental/output.json\",\"BatchJobDetails\":{\"HostFilter\":{\"Attempts\":[{\"Container\":{\"ContainerInstanceArn\":\"arn:aws:ecs:us-west-2:123456789012:container-instance/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/4213762631364a818592795ac6becc76\",\"ExitCode\":0,\"LogStreamName\":\"idseq-dev-main/default/43756258c9a14677b7c4fde0af574bf5\",\"NetworkInterfaces\":[],\"TaskArn\":\"arn:aws:ecs:us-west-2:123456789012:task/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/43756258c9a14677b7c4fde0af574bf5\"},\"StartedAt\":1582150715389,\"StatusReason\":\"Essential container in task exited\",\"StoppedAt\":1582150953334}],\"Container\":{\"Command\":[\"/bin/bash\",\"-c\",\"for i in \\\"$@\\\"; do eval \\\"$i\\\"; done; cd /\",\"idseq\",\"set -a\",\"if [ -f /etc/environment ]; then source /etc/environment; fi\",\"if [ -f /etc/default/locale ]; then source /etc/default/locale; else export LC_ALL=C.UTF-8 LANG=C.UTF-8; fi\",\"set +a\",\"set -x\",\"rm -rf /mnt/20*\",\"df -h\",\"export AWS_DEFAULT_REGION=us-west-2 S3PARCP_DOCKER_IMAGE=123456789012.dkr.ecr.us-west-2.amazonaws.com/idseq-workflows\",\"if [ -f /etc/profile ]; then source /etc/profile; fi\",\"miniwdl --version\",\"set -euo pipefail\",\"export CURRENT_STATE=$(echo \\\"$CURRENT_STATE\\\" | sed -e s/SPOT// -e s/EC2//)\",\"aws s3 cp \\\"$WDL_WORKFLOW_URI\\\" .\",\"echo \\\"$WDL_INPUT\\\" > wdl_input.json\",\"miniwdl run --dir /mnt $(basename \\\"$WDL_WORKFLOW_URI\\\") --input wdl_input.json --verbose > wdl_output.json\",\"export WDL_OUTPUT_PREFIX=$(dirname \\\"$WDL_OUTPUT_URI\\\")\",\"jq .outputs wdl_output.json > wdl_out_s3.json\",\"for k in $(jq -r keys[] wdl_out_s3.json); do export k; local_path=$(jq -r '.[env.k]' wdl_out_s3.json); filename=$(basename \\\"$local_path\\\"); export dest=\\\"$WDL_OUTPUT_PREFIX/$filename\\\"; s3parcp \\\"$local_path\\\" \\\"$dest\\\"; jq '.[env.k]=env.dest' wdl_out_s3.json | sponge wdl_out_s3.json; done\",\"aws s3 cp wdl_out_s3.json \\\"$WDL_OUTPUT_URI\\\"\"],\"ContainerInstanceArn\":\"arn:aws:ecs:us-west-2:123456789012:container-instance/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/4213762631364a818592795ac6becc76\",\"Environment\":[{\"Name\":\"WDL_WORKFLOW_URI\",\"Value\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter.wdl\"},{\"Name\":\"WDL_OUTPUT_URI\",\"Value\":\"s3://dummy-s3-bucket/samples/123/12345/sfn-wdl/host_filter/output.json\"},{\"Name\":\"CURRENT_STATE\",\"Value\":\"HostFilterSPOT\"},{\"Name\":\"WDL_INPUT\",\"Value\":\"{\\\"fastqs_0\\\": \\\"s3://dummy-s3-bucket/samples/123/12345/fastqs/RR004_water_2_S23C_R2_001.fastq\\\"}\"},{\"Name\":\"MANAGED_BY_AWS\",\"Value\":\"STARTED_BY_STEP_FUNCTIONS\"}],\"ExitCode\":0,\"Image\":\"123456789012.dkr.ecr.us-west-2.amazonaws.com/idseq-workflows\",\"JobRoleArn\":\"arn:aws:iam::123456789012:role/idseq-dev-batch-job\",\"LogStreamName\":\"idseq-dev-main/default/43756258c9a14677b7c4fde0af574bf5\",\"Memory\":1024,\"MountPoints\":[{\"ContainerPath\":\"/mnt\",\"ReadOnly\":false,\"SourceVolume\":\"scratch\"},{\"ContainerPath\":\"/var/run/docker.sock\",\"ReadOnly\":false,\"SourceVolume\":\"docker_sock\"}],\"NetworkInterfaces\":[],\"Privileged\":false,\"ReadonlyRootFilesystem\":false,\"ResourceRequirements\":[],\"TaskArn\":\"arn:aws:ecs:us-west-2:123456789012:task/idseq-dev-main-SPOT-20200214190358934900000002_Batch_374566d1-1234-5678-9abc-def012345678/43756258c9a14677b7c4fde0af574bf5\",\"Ulimits\":[{\"HardLimit\":100000,\"Name\":\"nofile\",\"SoftLimit\":100000}],\"Vcpus\":16,\"Volumes\":[{\"Host\":{\"SourcePath\":\"/mnt\"},\"Name\":\"scratch\"},{\"Host\":{\"SourcePath\":\"/var/run/docker.sock\"},\"Name\":\"docker_sock\"}]},\"CreatedAt\":1582150678868,\"DependsOn\":[],\"JobDefinition\":\"arn:aws:batch:us-west-2:123456789012:job-definition/idseq-dev-main:28\",\"JobId\":\"886b0371-1234-5678-9abc-def012345678\",\"JobName\":\"idseq-dev-main-HostFilterSPOT\",\"JobQueue\":\"arn:aws:batch:us-west-2:123456789012:job-queue/idseq-dev-main-SPOT-normal\",\"Parameters\":{},\"RetryStrategy\":{\"Attempts\":1},\"StartedAt\":1582150715389,\"Status\":\"SUCCEEDED\",\"StatusReason\":\"Essential container in task exited\",\"StoppedAt\":1582150953334,\"Timeout\":{\"AttemptDurationSeconds\":86400}}}},\"CurrentState\":\"HostFilterReadOutput\"}}"
            }
        },
        {
            "timestamp": 1582150955.809,
            "type": "TaskStarted",
            "id": 10,
            "previousEventId": 9,
            "taskStartedEventDetails": {
                "resourceType": "lambda",
                "resource": "invoke"
            }
        },
        {
            "timestamp": 1582150956.584,
            "type": "TaskFailed",
            "id": 11,
            "previousEventId": 10,
            "taskFailedEventDetails": {
                "resourceType": "lambda",
                "resource": "invoke",
                "error": "KeyError",
                "cause": "{\"errorMessage\":\"'idseq_host_filter.gsnap_filter_out_1_gsnap_filter_2_fa'\",\"errorType\":\"KeyError\",\"stackTrace\":[\"  File \\\"/var/task/app.py\\\", line 116, in read_state_from_s3\\n    input_uri = sfn_state[\\\"Result\\\"][result_key]\\n\"]}"
            }
        },
        {
            "timestamp": 1582150956.584,
            "type": "ExecutionFailed",
            "id": 12,
            "previousEventId": 11,
            "executionFailedEventDetails": {
                "error": "KeyError",
                "cause": "{\"errorMessage\":\"'idseq_host_filter.gsnap_filter_out_1_gsnap_filter_2_fa'\",\"errorType\":\"KeyError\",\"stackTrace\":[\"  File \\\"/var/task/app.py\\\", line 116, in read_state_from_s3\\n    input_uri = sfn_state[\\\"Result\\\"][result_key]\\n\"]}"
            }
        }
    ]
}
