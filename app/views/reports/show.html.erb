<p id="notice"><%= notice %></p>

<p>
  <strong>Name:</strong>
  <%= @report.name %>
</p>

<p>
  <strong>Pipeline output:</strong>
  <%= link_to @report.pipeline_output.name, @report.pipeline_output %>
</p>

<p>
  <strong>Sample:</strong>
  <%= link_to @report.pipeline_output.sample.name, @report.pipeline_output.sample %>
</p>

<p>
  <strong>Project:</strong>
  <%= link_to @report.pipeline_output.sample.project.name, @report.pipeline_output.sample.project %>
</p>

<p>
  <strong>Background:</strong>
  <%= link_to @report.background.name, @report.background %>
</p>

<p>
  <strong>Date created:</strong>
  <%= @report.created_at %>
</p>

<p>
  <strong>Taxon scores:</strong>
</p>

<%= form_for @report, method: :get, url: report_path(@report) do |f| %>
  Threshold for NT Species Z: <%= text_field_tag :nt_zscore_threshold, (@nt_zscore_threshold || -1) %><br>
  Threshold for NT Species rM: <%= text_field_tag :nt_rpm_threshold, (@nt_rpm_threshold || 0) %><br>
  <%= f.submit %>
<% end %>

<table class="table table-condensed">
      <thead>
        <tr>
          <th>Taxon ID</th>
          <th>Taxon Name</th>
          <th>NT Species Z</th>
          <th>NT Species rM</th>
        </tr>
      </thead>
      <tbody>
        <% if @nt_zscore_threshold %>
          <% zscores_display = @report.taxon_zscores.where("nt_zscore >= #{@nt_zscore_threshold}") %>
        <% else %>
          <% zscores_display = @report.taxon_zscores %>
        <% end %>
        <% if @nt_rpm_threshold %>
          <% zscores_display = zscores_display.where("nt_rpm >= #{@nt_rpm_threshold}") %>
        <% end %>
        <% zscores_display.order(nt_zscore: :desc, nt_rpm: :desc).each do |element| %>
          <tr>
            <td><%= element.tax_id %></td>
            <td><%= element.name %></td>
            <td><%= element.nt_zscore %></td>
            <td><%= element.nt_rpm %></td>
         </tr>
        <% end %>
      </tbody>
    </table>

<p>
<%= link_to 'Edit', edit_report_path(@report) %> |
<%= link_to 'See all reports', reports_path %> |
<%= link_to 'Front portal', root_path %>
</p>
